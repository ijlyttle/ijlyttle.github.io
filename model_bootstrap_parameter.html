<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Parameter-assessment using bootstrapping</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="site_libs/highlight/default.css"
      type="text/css" />
<script src="site_libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>

<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.9em;
  padding-left: 5px;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Wanderings through the Tidyverse</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Dimensions
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Ingest</li>
    <li class="dropdown-header">Tidy</li>
    <li class="dropdown-header">Transform</li>
    <li class="dropdown-header">Visualize</li>
    <li class="dropdown-header">Model</li>
    <li>
      <a href="model_introduction.html">Introduction</a>
    </li>
    <li>
      <a href="model_cv_selection.html">Model-selection using cross-validation</a>
    </li>
    <li>
      <a href="model_bootstrap_parameter.html">Parameter-assessment using bootstrapping</a>
    </li>
    <li class="dropdown-header">Communicate</li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Non-dimensions
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Introduction</li>
    <li class="dropdown-header">Dates and times</li>
    <li class="dropdown-header">API-client design</li>
    <li class="dropdown-header">Makefiles for project manangement</li>
    <li class="dropdown-header">Custom R Markdown formats</li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Package portfolio
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">vembedr</li>
    <li class="dropdown-header">bsplus</li>
    <li class="dropdown-header">shinypod</li>
    <li class="dropdown-header">humidr</li>
    <li class="dropdown-header">groundTemp</li>
  </ul>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Parameter-assessment using bootstrapping</h1>

</div>


<pre class="r"><code>library(&quot;devtools&quot;)
library(&quot;tibble&quot;)
library(&quot;ggplot2&quot;)
library(&quot;modelr&quot;)
library(&quot;dplyr&quot;)</code></pre>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<pre class="r"><code>library(&quot;purrr&quot;)</code></pre>
<pre><code>## 
## Attaching package: &#39;purrr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     contains, order_by</code></pre>
<pre class="r"><code>library(&quot;tidyr&quot;)
library(&quot;pryr&quot;)</code></pre>
<pre><code>## 
## Attaching package: &#39;pryr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:purrr&#39;:
## 
##     compose, partial</code></pre>
<pre class="r"><code>library(&quot;broom&quot;)</code></pre>
<pre><code>## 
## Attaching package: &#39;broom&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:modelr&#39;:
## 
##     bootstrap</code></pre>
<pre class="r"><code>knitr::opts_chunk$set(comment = &quot;&quot;) # put this into a format, once developed</code></pre>
<p>In this page, we want to take models we have selected using cross-validation, then assess their parameters using bootstrapping.</p>
<p>The goal of parameter assessment is to demonstrate (hopefully) that each of your parameters is significantly different from zero, to justify each parameter’s inclusion in a model.</p>
<div id="linear-regresssion" class="section level2">
<h2>Linear Regresssion</h2>
<p>Let’s recreate our example from earlier. Thanks to randomization, this will not be exactly the same dataset as before, but that’s OK.</p>
<pre class="r"><code>truth &lt;- function(x){
  1 + 2*x - x^2
}

noise &lt;- function(x){
  rnorm(length(x), sd = 0.1)
}</code></pre>
<pre class="r"><code>df_regression &lt;- 
  data_frame(
    x = runif(n = 100, min = 0, max = 1),
    y = truth(x) + noise(x)
  ) %&gt;%
  print()</code></pre>
<pre><code># A tibble: 100 x 2
            x         y
        &lt;dbl&gt;     &lt;dbl&gt;
1  0.70274177 1.9053061
2  0.62701125 1.8930492
3  0.08188646 1.0545515
4  0.89678688 1.9519722
5  0.03656670 0.9710016
6  0.59001726 1.9586416
7  0.18348746 1.3736965
8  0.10180163 0.9572116
9  0.56534652 1.8125664
10 0.22376913 1.5187460
# ... with 90 more rows</code></pre>
<pre class="r"><code>ggplot(df_regression, aes(x = x, y = y)) +
  stat_function(fun = truth, color = &quot;black&quot;, alpha = 0.7, linetype = &quot;dashed&quot;) +
  geom_point(alpha = 0.6)</code></pre>
<p><img src="model_bootstrap_parameter_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>In bootstrapping, the thought is to create a bunch of new datasets sampled <strong>with</strong> replacement from the original dataset. Thankfully, there is a “modelr” function to help us.</p>
<pre class="r"><code>df_regression_bootstrap &lt;- 
  df_regression %&gt;%
  modelr::bootstrap(10000) %&gt;% # broom-modelr collision alert
  print()</code></pre>
<pre><code># A tibble: 10,000 x 2
            strap   .id
           &lt;list&gt; &lt;chr&gt;
1  &lt;S3: resample&gt; 00001
2  &lt;S3: resample&gt; 00002
3  &lt;S3: resample&gt; 00003
4  &lt;S3: resample&gt; 00004
5  &lt;S3: resample&gt; 00005
6  &lt;S3: resample&gt; 00006
7  &lt;S3: resample&gt; 00007
8  &lt;S3: resample&gt; 00008
9  &lt;S3: resample&gt; 00009
10 &lt;S3: resample&gt; 00010
# ... with 9,990 more rows</code></pre>
<p>Using this dataframe, we can evaluate our quadratic model for each member of <code>strap</code>.</p>
<pre class="r"><code>fn_model &lt;- function(data){
  lm(y ~ poly(x, 2), data = data)
}

df_regression_bootstrap_model &lt;- 
  df_regression_bootstrap %&gt;%
  mutate(model = map(strap, fn_model)) %&gt;%
  print()</code></pre>
<pre><code># A tibble: 10,000 x 3
            strap   .id    model
           &lt;list&gt; &lt;chr&gt;   &lt;list&gt;
1  &lt;S3: resample&gt; 00001 &lt;S3: lm&gt;
2  &lt;S3: resample&gt; 00002 &lt;S3: lm&gt;
3  &lt;S3: resample&gt; 00003 &lt;S3: lm&gt;
4  &lt;S3: resample&gt; 00004 &lt;S3: lm&gt;
5  &lt;S3: resample&gt; 00005 &lt;S3: lm&gt;
6  &lt;S3: resample&gt; 00006 &lt;S3: lm&gt;
7  &lt;S3: resample&gt; 00007 &lt;S3: lm&gt;
8  &lt;S3: resample&gt; 00008 &lt;S3: lm&gt;
9  &lt;S3: resample&gt; 00009 &lt;S3: lm&gt;
10 &lt;S3: resample&gt; 00010 &lt;S3: lm&gt;
# ... with 9,990 more rows</code></pre>
<p>Now we want to get the parameters. So we use “broom”.</p>
<pre class="r"><code>df_regression_bootstrap_param &lt;-
  df_regression_bootstrap_model %&gt;%
  mutate(param = map(model, tidy)) %&gt;%
  select(.id, param) %&gt;%
  unnest() %&gt;%
  print()</code></pre>
<pre><code># A tibble: 30,000 x 6
     .id        term   estimate   std.error  statistic       p.value
   &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;
1  00001 (Intercept)  1.6469637 0.009769677 168.579145 1.566190e-121
2  00001 poly(x, 2)1  3.1634840 0.097696767  32.380641  8.381100e-54
3  00001 poly(x, 2)2 -0.8783423 0.097696767  -8.990495  2.026929e-14
4  00002 (Intercept)  1.6813579 0.009638254 174.446321 5.732090e-123
5  00002 poly(x, 2)1  2.8149701 0.096382536  29.206226  7.397393e-50
6  00002 poly(x, 2)2 -0.9746452 0.096382536 -10.112260  7.673827e-17
7  00003 (Intercept)  1.6583390 0.008977295 184.725911 2.256732e-125
8  00003 poly(x, 2)1  3.1793863 0.089772949  35.415861  2.757407e-57
9  00003 poly(x, 2)2 -0.9117471 0.089772949 -10.156145  6.170427e-17
10 00004 (Intercept)  1.6709324 0.009162670 182.363039 7.839082e-125
# ... with 29,990 more rows</code></pre>
<pre class="r"><code>df_regression_bootstrap_param %&gt;%
  ggplot(aes(x = estimate)) + 
  geom_histogram(binwidth = 0.05) +
  facet_grid(term ~ ., scales = &quot;free_x&quot;) </code></pre>
<p><img src="model_bootstrap_parameter_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Our goal here is to show that the parameter-observations stay “far enough” away from zero. Let’s start by determining the mean for each term:</p>
<pre class="r"><code>df_regression_bootstrap_param_mean &lt;- 
  df_regression_bootstrap_param %&gt;%
  group_by(term) %&gt;%
  summarize(estimate_mean = mean(estimate)) %&gt;%
  print()</code></pre>
<pre><code># A tibble: 3 x 2
         term estimate_mean
        &lt;chr&gt;         &lt;dbl&gt;
1 (Intercept)     1.6641913
2 poly(x, 2)1     3.0301957
3 poly(x, 2)2    -0.8524207</code></pre>
<p>Note to self - I think the <code>poly()</code> function uses orthogonal polynomials, so I’d like to find out how to transform these coefficient estimates into coefficients that multiply <span class="math inline">\((1, x, x^2)\)</span>. I know it’s something simple - just to sit down and do it.</p>
<p>There are two ways we can further investigate the significance of each term - visually, and to make a table of the proportion of bootstrap models where the sign of the parameter is different from the sign of the mean.</p>
<pre class="r"><code>df_regression_bootstrap_param_scaled &lt;- 
  df_regression_bootstrap_param %&gt;%
  left_join(df_regression_bootstrap_param_mean, by = &quot;term&quot;) %&gt;%
  transmute(
    .id,
    term,
    estimate_scaled = estimate/estimate_mean
  ) %&gt;%
  print()</code></pre>
<pre><code># A tibble: 30,000 x 3
     .id        term estimate_scaled
   &lt;chr&gt;       &lt;chr&gt;           &lt;dbl&gt;
1  00001 (Intercept)       0.9896481
2  00001 poly(x, 2)1       1.0439867
3  00001 poly(x, 2)2       1.0304094
4  00002 (Intercept)       1.0103152
5  00002 poly(x, 2)1       0.9289730
6  00002 poly(x, 2)2       1.1433852
7  00003 (Intercept)       0.9964834
8  00003 poly(x, 2)1       1.0492347
9  00003 poly(x, 2)2       1.0695976
10 00004 (Intercept)       1.0040507
# ... with 29,990 more rows</code></pre>
<pre class="r"><code>df_regression_bootstrap_param_scaled %&gt;%
  ggplot(aes(x = estimate_scaled)) + 
  geom_histogram(binwidth = 0.01) +
  xlim(0, NA) +
  facet_grid(term ~ ., scales = &quot;free_x&quot;) </code></pre>
<p><img src="model_bootstrap_parameter_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>This gives us an idea (I think) of the relative confidence we can have in each of the parameter estimates, although it seems we can be confident in all of them.</p>
<p>Let’s look at some summaries for each set of scaled estimates:</p>
<pre class="r"><code>df_regression_bootstrap_param_scaled %&gt;%
  group_by(term) %&gt;%
  summarize(
    n_bootstrap = n(),
    n_sign_opposite = sum(sign(estimate_scaled) != 1)/n(),
    min_estimate_scaled = min(estimate_scaled)
  ) %&gt;%
  print()</code></pre>
<pre><code># A tibble: 3 x 4
         term n_bootstrap n_sign_opposite min_estimate_scaled
        &lt;chr&gt;       &lt;int&gt;           &lt;dbl&gt;               &lt;dbl&gt;
1 (Intercept)       10000               0           0.9245606
2 poly(x, 2)1       10000               0           0.7203893
3 poly(x, 2)2       10000               0           0.5816196</code></pre>
<p>It may also be interesting to look at the interquartile range as way to quantify our confidence.</p>
<pre class="r"><code>df_regression_bootstrap_param %&gt;%
  group_by(term) %&gt;%
  summarize(
    q_25 = quantile(estimate, 0.25),
    median = median(estimate, 0.5),
    q_75 = quantile(estimate, 0.75)
  ) %&gt;%
  print()</code></pre>
<pre><code># A tibble: 3 x 4
         term       q_25    median       q_75
        &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 (Intercept)  1.6423551  1.664510  1.6867524
2 poly(x, 2)1  2.9004631  3.037888  3.1654263
3 poly(x, 2)2 -0.9241432 -0.851439 -0.7809953</code></pre>
<p>Finally, it may be interesting to look at our bootstrapped models, along with the original data, and the “truth”. Of course, we recognize that we can pull this off thanks to our single independent variable.</p>
<pre class="r"><code>grid &lt;- 
  df_regression %&gt;% 
  expand(x = seq_range(x, 20))

boot_pred &lt;- 
  df_regression_bootstrap_model %&gt;% 
  transmute(
    .id,
    data = map2(list(grid), model, add_predictions, var = &quot;y&quot;)
  ) %&gt;%
  unnest() %&gt;%
  print()</code></pre>
<pre><code># A tibble: 200,000 x 3
     .id            x         y
   &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;
1  00001 0.0007436525 0.9663702
2  00001 0.0531971913 1.0794331
3  00001 0.1056507301 1.1857317
4  00001 0.1581042690 1.2852659
5  00001 0.2105578078 1.3780358
6  00001 0.2630113467 1.4640413
7  00001 0.3154648855 1.5432825
8  00001 0.3679184244 1.6157593
9  00001 0.4203719632 1.6814718
10 00001 0.4728255021 1.7404199
# ... with 199,990 more rows</code></pre>
<pre class="r"><code>ggplot(data = df_regression, mapping = aes(x = x, y = y)) +
  geom_line(
    data = boot_pred %&gt;% filter(as.numeric(.id) &lt; 3000), 
    aes(group = .id), 
    color = &quot;blue&quot;, 
    alpha = 0.002
  ) +
  stat_function(fun = truth, color = &quot;black&quot;, linetype = &quot;dashed&quot;, size = 1) +
  geom_point(data = df_regression, alpha = 0.5) </code></pre>
<p><img src="model_bootstrap_parameter_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>To my eye, it seems that the “truth” function does not intersect the area occupied by bootstrap models as well as I would like. It could be that I don’t understand bootstrapping as well as I should.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
